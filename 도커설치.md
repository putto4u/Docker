 우분투에 Docker Engine을 설치하는 **가장 안정적이고 권장되는 공식적인 방법**을 자세히 안내합니다.

> **IT 전문가의 실전 팁:** Docker를 설치한 후 매번 `sudo` 없이 명령어를 실행할 수 있도록 사용자 권한을 설정하는 것이 보안과 편의성 측면에서 매우 중요합니다. 이 부분에 특히 주의하여 설정을 진행해야 합니다.

## 우분투에 Docker Engine 설치 상세 가이드

### 1단계: 이전 버전 제거 및 환경 정리 (선택 사항)

이전에 설치된 Docker 관련 패키지나 충돌 가능성이 있는 패키지가 있다면, 안정적인 설치를 위해 먼저 제거하는 것을 권장합니다.

```bash
# 기존 Docker 관련 패키지 제거
for pkg in docker.io docker-engine docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin; do sudo apt remove $pkg; done

# 이미지, 컨테이너, 볼륨 등 모든 데이터까지 완전히 삭제하려면 다음 명령을 사용합니다.
# sudo rm -rf /var/lib/docker
# sudo rm -rf /var/lib/containerd
```

### 2단계: Docker 공식 저장소 설정 (필수)

Docker의 공식 저장소(Repository)를 설정하여, `apt` 패키지 관리자를 통해 최신 버전을 다운로드하고 관리할 수 있도록 합니다.

1.  **필요한 패키지 설치:**

    ```bash
    sudo apt update
    sudo apt install ca-certificates curl
    ```

2.  **Docker 공식 GPG 키 추가:**
    다운로드할 패키지의 무결성을 확인하기 위해 Docker의 공식 GPG 키를 다운로드하고 시스템에 등록합니다. **이 과정은 보안상 매우 중요합니다.**

    ```bash
    sudo install -m 0755 -d /etc/apt/keyrings
    sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
    sudo chmod a+r /etc/apt/keyrings/docker.asc
    ```

3.  **저장소 등록:**
    APT 소스 목록에 Docker의 **안정(stable)** 저장소를 추가합니다. 시스템 아키텍처와 우분투 코드네임을 자동으로 감지하여 설정합니다.

    ```bash
    # `$(. /etc/os-release && echo "$VERSION_CODENAME")`는 우분투 배포판 이름(예: jammy, focal)을 자동으로 찾아줍니다.
    echo \
      "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
      $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
      sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
    ```

    > **자주 오해하거나 실수하는 부분:** 위의 명령어에서 배포판 코드네임을 찾지 못한다는 에러가 발생하면, `$(. /etc/os-release && echo "$VERSION_CODENAME")` 대신 사용 중인 우분투 버전에 맞는 코드네임(예: `jammy`, `focal`)을 직접 입력해야 합니다.

### 3단계: Docker Engine 설치 및 확인

1.  **APT 패키지 인덱스 업데이트:**
    새로 등록한 Docker 저장소의 패키지 목록을 반영합니다.

    ```bash
    sudo apt update
    ```

2.  **Docker 패키지 설치:**
    Docker Engine, CLI, Containerd 및 기타 필수 플러그인을 설치합니다.

    ```bash
    sudo apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
    ```

3.  **설치 검증:**
    Docker 서비스가 정상적으로 실행되는지 확인하고, `hello-world` 이미지를 실행하여 설치를 검증합니다.

    ```bash
    # Docker 서비스 상태 확인
    sudo systemctl status docker

    # 테스트 이미지 실행으로 최종 확인
    sudo docker run hello-world
    ```

    터미널에 "Hello from Docker\!" 메시지가 출력되면 설치가 성공적으로 완료된 것입니다.

### 4단계: 비-root 사용자로 Docker 관리 권한 설정 (핵심 보안 설정)

매번 `sudo`를 입력하지 않고 Docker 명령을 실행할 수 있도록 사용자 계정에 권한을 부여합니다.

1.  **`docker` 그룹에 사용자 추가:**
    현재 로그인된 사용자 계정을 `docker` 그룹에 추가합니다.

    ```bash
    # 여기서 $USER 환경 변수는 현재 로그인된 사용자의 이름을 나타냅니다.
    sudo usermod -aG docker $USER
    ```

2.  **변경 사항 적용 (재로그인 또는 재부팅):**
    그룹 변경 사항을 시스템에 반영하려면 **반드시 재로그인**하거나 시스템을 재부팅해야 합니다.

3.  **`sudo` 없이 실행 확인:**
    재로그인 후, `sudo` 없이 다음 명령을 실행하여 권한 설정을 최종 확인합니다.

    ```bash
    docker run hello-world
    ```

    "Hello from Docker\!" 메시지가 출력되면 모든 설정이 완료된 것입니다. 이제 `sudo` 없이 컨테이너를 관리할 수 있습니다.
