 우분투에 Docker Engine을 설치하는 **가장 안정적이고 권장되는 공식적인 방법**을 자세히 안내합니다.

> **IT 전문가의 실전 팁:** Docker를 설치한 후 매번 `sudo` 없이 명령어를 실행할 수 있도록 사용자 권한을 설정하는 것이 보안과 편의성 측면에서 매우 중요합니다. 이 부분에 특히 주의하여 설정을 진행해야 합니다.

## 우분투에 Docker Engine 설치 상세 가이드

### 1단계: 이전 버전 제거 및 환경 정리 (선택 사항)

이전에 설치된 Docker 관련 패키지나 충돌 가능성이 있는 패키지가 있다면, 안정적인 설치를 위해 먼저 제거하는 것을 권장합니다.

```bash
# 기존 Docker 관련 패키지 제거
for pkg in docker.io docker-engine docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin; do sudo apt remove $pkg; done

# 이미지, 컨테이너, 볼륨 등 모든 데이터까지 완전히 삭제하려면 다음 명령을 사용합니다.
# sudo rm -rf /var/lib/docker
# sudo rm -rf /var/lib/containerd
```

### 2단계: Docker 공식 저장소 설정 (필수)

Docker의 공식 저장소(Repository)를 설정하여, `apt` 패키지 관리자를 통해 최신 버전을 다운로드하고 관리할 수 있도록 합니다.

1.  **필요한 패키지 설치:**

    ```bash
    sudo apt update
    sudo apt install ca-certificates curl
    ```

2.  **Docker 공식 GPG 키 추가:**
    다운로드할 패키지의 무결성을 확인하기 위해 Docker의 공식 GPG 키를 다운로드하고 시스템에 등록합니다. **이 과정은 보안상 매우 중요합니다.**

    ```bash
    sudo install -m 0755 -d /etc/apt/keyrings
    sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
    sudo chmod a+r /etc/apt/keyrings/docker.asc
    ```

3.  **저장소 등록:**
    APT 소스 목록에 Docker의 **안정(stable)** 저장소를 추가합니다. 시스템 아키텍처와 우분투 코드네임을 자동으로 감지하여 설정합니다.

    ```bash
    # `$(. /etc/os-release && echo "$VERSION_CODENAME")`는 우분투 배포판 이름(예: jammy, focal)을 자동으로 찾아줍니다.
    echo \
      "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.asc] https://download.docker.com/linux/ubuntu \
      $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | \
      sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
    ```

    > **자주 오해하거나 실수하는 부분:** 위의 명령어에서 배포판 코드네임을 찾지 못한다는 에러가 발생하면, `$(. /etc/os-release && echo "$VERSION_CODENAME")` 대신 사용 중인 우분투 버전에 맞는 코드네임(예: `jammy`, `focal`)을 직접 입력해야 합니다.

### 3단계: Docker Engine 설치 및 확인

1.  **APT 패키지 인덱스 업데이트:**
    새로 등록한 Docker 저장소의 패키지 목록을 반영합니다.

    ```bash
    sudo apt update
    ```

2.  **Docker 패키지 설치:**
    Docker Engine, CLI, Containerd 및 기타 필수 플러그인을 설치합니다.

    ```bash
    sudo apt install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
    ```

3.  **설치 검증:**
    Docker 서비스가 정상적으로 실행되는지 확인하고, `hello-world` 이미지를 실행하여 설치를 검증합니다.

    ```bash
    # Docker 서비스 상태 확인
    sudo systemctl status docker

    # 테스트 이미지 실행으로 최종 확인
    sudo docker run hello-world
    ```

    터미널에 "Hello from Docker\!" 메시지가 출력되면 설치가 성공적으로 완료된 것입니다.

### 4단계: 비-root 사용자로 Docker 관리 권한 설정 (핵심 보안 설정)

매번 `sudo`를 입력하지 않고 Docker 명령을 실행할 수 있도록 사용자 계정에 권한을 부여합니다.

1.  **`docker` 그룹에 사용자 추가:**
    현재 로그인된 사용자 계정을 `docker` 그룹에 추가합니다.

    ```bash
    # 여기서 $USER 환경 변수는 현재 로그인된 사용자의 이름을 나타냅니다.
    sudo usermod -aG docker $USER
    ```

2.  **변경 사항 적용 (재로그인 또는 재부팅):**
    그룹 변경 사항을 시스템에 반영하려면 **반드시 재로그인**하거나 시스템을 재부팅해야 합니다.

3.  **`sudo` 없이 실행 확인:**
    재로그인 후, `sudo` 없이 다음 명령을 실행하여 권한 설정을 최종 확인합니다.

    ```bash
    docker run hello-world
    ```

    "Hello from Docker\!" 메시지가 출력되면 모든 설정이 완료된 것입니다. 이제 `sudo` 없이 컨테이너를 관리할 수 있습니다.

    ---

    도커(Docker)와 쿠버네티스(Kubernetes) 운영 시 명령어 자동완성(Auto-completion)은 오타를 줄이고 생산성을 높여주는 필수 기능입니다. 특히 긴 리소스 이름이나 복잡한 플래그를 다룰 때 매우 유용합니다.

각 도구별 설정 방법을 정리해 드립니다.

---

## 1. Docker 자동완성 설정

최신 버전의 Docker는 쉘 종류에 맞는 자동완성 스크립트를 생성하는 명령어를 내장하고 있습니다.

### **Bash (Linux)**

1. `bash-completion` 패키지가 필요합니다.
```bash
sudo apt install bash-completion -y
apt list --installed | grep bash-completion
```


2. 자동완성 스크립트를 등록합니다.
```bash
# 스크립트 생성 및 적용
mkdir -p ~/.local/share/bash-completion/completions
docker completion bash > ~/.local/share/bash-completion/completions/docker

# 바로 적용
source ~/.bashrc

```



### **Zsh (macOS 등)**

`~/.zshrc` 파일에 다음 내용을 추가합니다.

```zsh
# ~/.zshrc에 추가
mkdir -p ~/.docker/completions
docker completion zsh > ~/.docker/completions/_docker
fpath=(~/.docker/completions $fpath)
autoload -Uz compinit && compinit

```

---

## 2. Kubernetes (kubectl) 자동완성 설정

`kubectl`은 자동완성 기능을 자체적으로 지원하며, 별칭(alias)인 `k`에 대해서도 설정하는 것이 실무 팁입니다.

### **Bash (Linux)**

```bash
# 1. bash-completion 설치 확인
sudo apt install bash-completion -y

# 2. kubectl 자동완성 영구 등록
echo 'source <(kubectl completion bash)' >> ~/.bashrc

# 3. 별칭(k) 자동완성 (매우 추천!)
echo 'alias k=kubectl' >> ~/.bashrc
echo 'complete -o default -F __start_kubectl k' >> ~/.bashrc

# 4. 설정 반영
source ~/.bashrc

```

### **Zsh (macOS)**

```zsh
# 1. kubectl 자동완성 등록
echo 'source <(kubectl completion zsh)' >> ~/.zshrc

# 2. 별칭(k) 자동완성
echo 'alias k=kubectl' >> ~/.zshrc
echo 'compdef __start_kubectl k' >> ~/.zshrc

# 3. 설정 반영
source ~/.zshrc

```

---

## 💡 실전 팁 & 자주 하는 실수

* **쉘 재시작 필수:** 설정 파일(`.bashrc` 또는 `.zshrc`)을 수정한 후에는 반드시 `source` 명령어로 반영하거나 터미널을 다시 열어야 작동합니다.
* **bash-completion 누락:** 리눅스 환경에서 자동완성이 작동하지 않는 가장 흔한 원인은 `bash-completion` 패키지가 설치되지 않았기 때문입니다.
* **별칭 사용 시 주의:** 단순히 `alias k=kubectl`만 선언하면 `k get pod [Tab]` 시 자동완성이 되지 않습니다. 반드시 위에 기재된 `complete` 또는 `compdef` 명령어를 함께 등록해야 합니다.

> [!NOTE]
> **출처 및 참고 사이트**
> * [Docker 공식 문서: CLI Completion](https://docs.docker.com/engine/cli/completion/)
> * [Kubernetes 공식 문서: kubectl 자동완성](https://www.google.com/search?q=https://kubernetes.io/ko/docs/reference/kubectl/cheatsheet/%23kubectl-%EC%9E%90%EB%8F%99-%EC%99%84%EC%84%B1)
> 
> 

---

이 설정이 완료되면 `kubectl get po [Tab]`을 눌러보세요. 현재 네임스페이스에 있는 Pod 목록이 자동으로 나타나는 것을 확인할 수 있습니다.


---

### 1. 'apt 리포지토리' (설치 전 설정한 것)

방금 질문하신 "도커 설치 전 설정하는 리포지토리"는 **내 VM이나 호스트가 아닙니다.**

* **위치**: 인터넷상에 있는 **도커 공식 서버** (https://www.google.com/search?q=download.docker.com)
* **역할**: "도커라는 프로그램을 다운로드할 수 있는 주소록"입니다.
* **설정 이유**: 우분투(내 VM)에게 "야, 도커 설치할 때 엄뚱한 데 가지 말고 여기 정식 매장(공식 리포지토리) 가서 최신판 가져와"라고 알려주는 작업입니다.

---

### 2. '도커 이미지 리포지토리' (도커 허브 등)

도커를 설치한 후 이미지를 올리고 내릴 때 말하는 리포지토리입니다.

* **원격(Remote) 리포지토리**: **도커 허브(Docker Hub)** 같은 곳입니다. 내 PC가 아닌 외부 서버입니다.
* **로컬(Local) 리포지토리**: 내 **호스트(VM) 내부**의 저장 공간입니다.
* `docker pull`을 하면 원격 리포지토리에서 내 VM(로컬 리포지토리)으로 이미지가 복사됩니다.
* `docker images` 명령어로 보는 목록이 바로 내 VM 안에 저장된 리포지토리 상태입니다.



---

### 3. 한눈에 보는 위치 비교

| 구분 | 위치 | 비유 |
| --- | --- | --- |
| **APT 리포지토리** | **인터넷 (Docker 공식 서버)** | 스마트폰의 **App Store** (앱을 받기 위한 곳) |
| **도커 허브 리포지토리** | **인터넷 (Cloud)** | **GitHub** (코드를 공유하는 곳) |
| **내 VM / 호스트** | **나의 로컬 서버** | **내 컴퓨터의 하드디스크** (설치된 앱이나 다운로드한 파일이 있는 곳) |

---

### 💡 전문가의 정리

"도커 리포지토리를 설정한다"는 말은 내 VM 안에 저장소를 만든다는 뜻이 아니라, **내 VM이 외부의 도커 보관소와 통신할 수 있도록 통로(주소)를 등록한다**는 뜻으로 이해하시면 정확합니다.

1. **설치 전**: 외부 통로(APT Repository) 등록
2. **설치 후**: 내 VM(Local)에 이미지 저장 및 외부(Remote)로 공유

---

### ⚠️ 자주 실수하는 부분

강의하시거나 실습하실 때 수강생들이 **"내 컴퓨터에 리포지토리를 만들었는데 왜 안 보이죠?"**라고 묻는다면, 그것은 대부분 **'로컬에 이미지를 빌드만 하고 원격(도커 허브)에 푸시(Push)하지 않았기 때문'**인 경우가 많습니다.

**이제 내 VM에 도커 설치를 완료하고, 실제로 이미지를 로컬에 저장하거나 허브로 올리는 실습 과정을 진행해 볼까요?**
